ROOT_DIR=$(cd $(dirname $0)/..;pwd)
ENVIRONMENT=$1  # productionなど
SITE=$2 # gcloudなど

mv $ROOT_DIR/.env $ROOT_DIR/.env.back
cp $ROOT_DIR/.env.$ENVIRONMENT-$SITE $ROOT_DIR/.env
cp $ROOT_DIR/.ebextensions/00_setup_security_group.config.$SITE $ROOT_DIR/.ebextensions/00_setup_security_group.config
cp $ROOT_DIR/.ebextensions/20_setup_https.config.$SITE $ROOT_DIR/.ebextensions/20_setup_https.config
ZIP_FILE=tmp/brimir_deliver_$ENVIRONMENT-$SITE-`date "+%Y%m%d-%H%M"`.zip
zip -r $ZIP_FILE . -x .'git/*' '.env.*' .gitignore Dockerfile 'docker/*' 'tmp/*' 'log/*' '.ebextensions/00_setup_security_group.config.*' '.ebextensions/20_setup_https.config.*'
mv $ROOT_DIR/.env.back $ROOT_DIR/.env
zip $ZIP_FILE tmp/pids/.gitkeep
zip $ZIP_FILE tmp/sockets/.gitkeep
zip $ZIP_FILE log/.gitkeep

echo created archive: `pwd`/$ZIP_FILE
